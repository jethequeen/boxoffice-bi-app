services:
  seats-sold:
    build: .
    image: seats-sold:latest
    container_name: seats-sold
    restart: unless-stopped

    # Cap /tmp so temp junk (screens, HTML, Playwright profiles) can’t explode
    tmpfs:
      - /tmp:size=1g,mode=1777

    # Keep Chromium happy
    shm_size: "1gb"

    # Rotate container stdout/stderr logs (json-file driver)
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"
        compress: "true"

    # Your envs
    env_file:
      - .env
    environment:
      - TZ=America/Toronto
      - CE_ACCEPT_LANG=fr-CA,fr;q=0.9,en;q=0.8
      - CE_BLOCK_ASSETS=0
      - CE_TIMEOUT_MS=90000
      - RESYNC_MIN=180
      - LOOKAHEAD_H=8
      - BACKPAD_MIN=30
      - FLUSH_MIN=60
      - FLUSH_BATCH=100
      - CHECK_DELAY_SEC=780
      - WINDOW_SEC=60
      - QUIET_START=01:00
      - QUIET_END=10:00
      - TMPDIR=/tmp/seats-sold
      # Turn OFF crash dumps unless you really need them
      - PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=0
      - PLAYWRIGHT_SKIP_VALIDATE_HOST_REQUIREMENTS=1
      - PLAYWRIGHT_DISABLE_MULTIPATH=1
      # Optional: toggle your own debug snapshots OFF by default
      - CE_DEBUG_SNAP=0
      # Optional: reduce Node’s default log noise if you add levels
      - LOG_LEVEL=info
